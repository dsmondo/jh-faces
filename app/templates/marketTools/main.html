{% extends 'base.html' %}
{% load static %}

{% block head_script %}
{% endblock %}

{% block title %}ì…ì§€ ë¶„ì„ë„êµ¬{% endblock %}
{% block content %}
    <div>
        <div class="map-container" id="map">
            <div class="sidebar" style="width:330px">
                <div class="sidebar-list">
                    <div style="display: flex;flex-direction: column;">
                        <div class="sidebar-card-top" style="height:auto">
                            <div class="sidebar-card-top-title">
                                <a style="cursor:pointer;" onclick="location.reload()">ì…ì§€ ë¶„ì„ë„êµ¬</a>
                            </div>
                            <div class="sidebar-tools">
                                <div class="menu-container">
                                    <div class="menu-title">
                                        <a>ê²€ìƒ‰</a>
                                        <div onclick="document.getElementById('gfid').value = '';"><i
                                                class="fa-solid fa-close"></i></div>
                                    </div>
                                    <form style="display: flex;justify-content: space-between;padding:0;" class="search"
                                          id="searchForm">
                                        <input style="width:185px;background-color: #FFFFFF" type="text" id="gfid"
                                               name="gfid" placeholder="ğŸ”  ê³ ìœ ì½”ë“œ">
                                        <label for="gfid" style="display: none">ê²€ìƒ‰</label>
                                        <button type="submit">ê²€ìƒ‰</button>
                                    </form>
                                </div>
                                <div class="menu-container">
                                    <div class="menu-title">
                                        <a>ê³µì‹œì§€ê°€</a>
                                        <div onclick="document.getElementById('minPrice').value = '';document.getElementById('maxPrice').value = '';">
                                            <i class="fa-solid fa-close"></i></div>
                                    </div>
                                    <form style="display: flex;justify-content: space-between;padding:0;" class="search"
                                          id="minmaxPriceForm">
                                        <input style="background-color: #FFFFFF" type="number" id="minPrice"
                                               name="minPrice" placeholder="ìµœì†Œ">
                                        <label for="minPrice" style="display: none">ìµœì†Œ</label>
                                        <a>-</a>
                                        <input style="background-color: #FFFFFF" type="number" id="maxPrice"
                                               name="maxPrice" placeholder="ìµœëŒ€">
                                        <label for="maxPrice" style="display: none">ìµœëŒ€</label>
                                        <button type="submit">ì„¤ì •</button>
                                    </form>
                                </div>
                                <div class="menu-container">
                                    <div class="menu-title">
                                        <a>ì‹ ê·œ ì¶”ì²œ ì…ì§€(ê·¸ë¦¬ë“œ)</a>
                                    </div>
                                    <div class="menu-button-container">
                                        {% if request.GET.ResultGEO1 %}
                                            <div class="menu-button"
                                                 onclick="manipulateURLParam('ResultGEO1', 'remove')">
                                                <a style="background-color: #F0766F;color:#FFFFFF">âœ” ê¸‰ì†</a>
                                            </div>
                                        {% else %}
                                            <div class="menu-button" onclick="manipulateURLParam('ResultGEO1', 'true')">
                                                <a>â–¡ ê¸‰ì†</a>
                                            </div>
                                        {% endif %}


                                        {% if request.GET.ResultGEO2 %}
                                            <div class="menu-button"
                                                 onclick="manipulateURLParam('ResultGEO2', 'remove')">
                                                <a style="background-color: #4277F1;color:#FFFFFF">âœ” ì™„ì†</a>
                                            </div>
                                        {% else %}
                                            <div class="menu-button" onclick="manipulateURLParam('ResultGEO2', 'true')">
                                                <a>â–¡ ì™„ì†</a>
                                            </div>
                                        {% endif %}


                                        {% if request.GET.ResultGEO3 %}
                                            <div class="menu-button"
                                                 onclick="manipulateURLParam('ResultGEO3', 'remove')">
                                                <a style="background-color: #BE83B9;color:#FFFFFF">âœ” ê¸‰/ì™„ì†</a>
                                            </div>
                                        {% else %}
                                            <div class="menu-button" onclick="manipulateURLParam('ResultGEO3', 'true')">
                                                <a>â–¡ ê¸‰/ì™„ì†</a>
                                            </div>
                                        {% endif %}
                                    </div>
                                </div>
                                <div class="menu-container">
                                    <div class="menu-title">
                                        <a>ë² ìŠ¤íŠ¸ ì¶”ì²œ ì…ì§€</a>
                                        <div onclick="window.open('{{ data.value.downloadURL }}', '_blank');"><i class="fa-solid fa-cloud-download"></i></div>
                                    </div>
                                    <div class="menu-button-container">
                                        {% if request.GET.RecommandGEO1 %}
                                            <div class="menu-button"
                                                 onclick="manipulateURLParam('RecommandGEO1', 'remove')">
                                                <a style="background-color: #1D3557;color:white">âœ” ê¸‰ì†</a>
                                            </div>
                                        {% else %}
                                            <div class="menu-button"
                                                 onclick="manipulateURLParam('RecommandGEO1', 'true')">
                                                <a>â–¡ ê¸‰ì†</a>
                                            </div>
                                        {% endif %}


                                        {% if request.GET.RecommandGEO2 %}
                                            <div class="menu-button"
                                                 onclick="manipulateURLParam('RecommandGEO2', 'remove')">
                                                <a style="background-color: #457B9D;color:white">âœ” ì™„ì†</a>
                                            </div>
                                        {% else %}
                                            <div class="menu-button"
                                                 onclick="manipulateURLParam('RecommandGEO2', 'true')">
                                                <a>â–¡ ì™„ì†</a>
                                            </div>
                                        {% endif %}


                                        {% if request.GET.RecommandGEO3 %}
                                            <div class="menu-button"
                                                 onclick="manipulateURLParam('RecommandGEO3', 'remove')">
                                                <a style="background-color: #750D37;color:white">âœ” ê¸‰/ì™„ì†</a>
                                            </div>
                                        {% else %}
                                            <div class="menu-button"
                                                 onclick="manipulateURLParam('RecommandGEO3', 'true')">
                                                <a>â–¡ ê¸‰/ì™„ì†</a>
                                            </div>
                                        {% endif %}


                                        {% if request.GET.RecommandGSGEO %}
                                            <div class="menu-button"
                                                 onclick="manipulateURLParam('RecommandGSGEO', 'remove')">
                                                <a style="background-color: #B87D4B;color:white">âœ” ì£¼ìœ ì†Œ</a>
                                            </div>
                                        {% else %}
                                            <div class="menu-button"
                                                 onclick="manipulateURLParam('RecommandGSGEO', 'true')">
                                                <a>â–¡ ì£¼ìœ ì†Œ</a>
                                            </div>
                                        {% endif %}
                                    </div>
                                </div>
                                <div class="menu-container">
                                    <div class="menu-title">
                                        <a>ê¸°ì¡´ ì¶©ì „ì†Œ ì¶”ê°€ ì„¤ì¹˜ ì¶”ì²œ</a>
                                    </div>
                                    <div class="menu-button-container">
                                        {% if request.GET.existInstalledGEO1 %}
                                            <div class="menu-button"
                                                 onclick="manipulateURLParam('existInstalledGEO1', 'remove')">
                                                <a style="background-color: #85FF9E;color:#000000">âœ” ê¸‰ì†</a>
                                            </div>
                                        {% else %}
                                            <div class="menu-button"
                                                 onclick="manipulateURLParam('existInstalledGEO1', 'true')">
                                                <a>â–¡ ê¸‰ì†</a>
                                            </div>
                                        {% endif %}


                                        {% if request.GET.existInstalledGEO2 %}
                                            <div class="menu-button"
                                                 onclick="manipulateURLParam('existInstalledGEO2', 'remove')">
                                                <a style="background-color: #F29361;color:white">âœ” ì™„ì†</a>
                                            </div>
                                        {% else %}
                                            <div class="menu-button"
                                                 onclick="manipulateURLParam('existInstalledGEO2', 'true')">
                                                <a>â–¡ ì™„ì†</a>
                                            </div>
                                        {% endif %}


                                        {% if request.GET.existInstalledGridGEO %}
                                            <div class="menu-button"
                                                 onclick="manipulateURLParam('existInstalledGridGEO', 'remove')">
                                                <a style="background-color: #EAC435;color:white">âœ” ê²©ì</a>
                                            </div>
                                        {% else %}
                                            <div class="menu-button"
                                                 onclick="manipulateURLParam('existInstalledGridGEO', 'true')">
                                                <a>â–¡ ê²©ì</a>
                                            </div>
                                        {% endif %}
                                    </div>
                                </div>
                            </div>

                        </div>
                        {% if data.ui.searchData == 'None' %}

                            <div class="card" id="card"
                                 style="background-color: #FFFFFF;margin: 10px 0 10px 20px;width:300px;">
                                <div class="card-title"
                                     style="display: flex;flex-direction: row;justify-content: space-between;padding-bottom: 10px">
                                    <a style="margin:0;color: #f5453d;">ê²€ìƒ‰ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤.</a>
                                    <div onclick="closeDetail();" style="width: 30px;height:30px;"><i
                                            style="color: #f5453d" class="fa-solid fa-close"></i></div>
                                </div>
                            </div>
                        {% else %}
                            <div class="card" id="card"
                                 style="display: none;background-color: #FFFFFF;margin: 10px 0 10px 20px;width:300px;">
                            </div>
                        {% endif %}
                    </div>
                </div>
            </div>
        </div>
    </div>

{% endblock %}s
{% block postScripts %}
    <script>
        function manipulateURLParam(param, action) {
            // í˜„ì¬ URLì„ ê°€ì ¸ì˜´
            let currentURL = window.location.href;

            // URLì— ë¬¼ìŒí‘œê°€ ìˆëŠ”ì§€ í™•ì¸
            let questionMarkIndex = currentURL.indexOf('?');
            let baseUrl = currentURL;
            let params = '';

            // URLì— ë¬¼ìŒí‘œê°€ ìˆëŠ” ê²½ìš°
            if (questionMarkIndex !== -1) {
                baseUrl = currentURL.substring(0, questionMarkIndex);
                params = currentURL.substring(questionMarkIndex + 1);
            }

            // URLì— íŒŒë¼ë¯¸í„°ê°€ ìˆëŠ” ê²½ìš°
            if (params) {
                let queryParams = params.split('&');
                let paramExists = false;

                // íŒŒë¼ë¯¸í„°ë¥¼ í™•ì¸í•˜ì—¬ ì´ë¯¸ ìˆëŠ” ê²½ìš° í”Œë˜ê·¸ ì„¤ì •
                for (let i = 0; i < queryParams.length; i++) {
                    let pair = queryParams[i].split('=');
                    if (pair[0] === param) {
                        paramExists = true;
                        // ì œê±° ë™ì‘ì¼ ê²½ìš° í•´ë‹¹ íŒŒë¼ë¯¸í„°ë¥¼ ë°°ì—´ì—ì„œ ì œê±°
                        if (action === 'remove') {
                            queryParams.splice(i, 1);
                        }
                        break;
                    }
                }

                // íŒŒë¼ë¯¸í„° ì¶”ê°€ ë™ì‘ì¼ ê²½ìš°
                if (action === 'true' && !paramExists) {
                    queryParams.push(param + '=true');
                }

                // ë³€ê²½ëœ íŒŒë¼ë¯¸í„°ë¡œ URL ë‹¤ì‹œ ìƒì„±
                let newParams = queryParams.join('&');
                let newURL = baseUrl + '?' + newParams;
                window.history.replaceState({}, '', newURL);
            } else {
                // URLì— íŒŒë¼ë¯¸í„°ê°€ ì—†ëŠ” ê²½ìš°
                if (action === 'true') {
                    window.history.replaceState({}, '', baseUrl + '?' + param + '=true');
                }
            }

            // í˜ì´ì§€ ë‹¤ì‹œ ë¡œë“œ
            location.reload();
        }

        function closeDetail() {
            let cardDiv = document.getElementById('card');
            if (cardDiv) {
                cardDiv.style.display = 'none';
            }
        }

        window.onload = function () {
            // Django ë·°ì—ì„œ ì „ë‹¬ë°›ì€ ê°’ í™•ì¸
            var searchData = "{{ data.ui.searchData }}";

            // searchData ê°’ì´ Noneì´ ì•„ë‹Œ ê²½ìš°
            if (searchData !== "None") {
                // íŒŒë¼ë¯¸í„°ëª…ìœ¼ë¡œ í•˜ë©´ì„œ íŒŒë¼ë¯¸í„° ê°’ì„ trueë¡œ ì¶”ê°€
                var urlParams = new URLSearchParams(window.location.search);
                urlParams.set(searchData, 'true');

                // URLì„ ìƒˆë¡œìš´ ì£¼ì†Œë¡œ ì—…ë°ì´íŠ¸
                window.history.replaceState({}, '', window.location.pathname + '?' + urlParams.toString());
            }
        };


        // URL íŒŒë¼ë¯¸í„°ë¥¼ êµ¬ë¬¸ ë¶„ì„í•˜ëŠ” í•¨ìˆ˜
        function getURLParams() {
            const urlParams = new URLSearchParams(window.location.search);
            const params = Object.fromEntries(urlParams.entries());
            return params;
        }

        // URL íŒŒë¼ë¯¸í„°ë¥¼ ì—…ë°ì´íŠ¸í•˜ëŠ” í•¨ìˆ˜
        function updateURLParams(params) {
            const searchParams = new URLSearchParams(params);
            const newURL = `${window.location.origin}${window.location.pathname}?${searchParams.toString()}`;
            window.history.replaceState({}, '', newURL);
            location.reload()
        }

        // ê²½ê³ ì°½ì„ ë„ìš°ê³  ì‚¬ìš©ìê°€ í™•ì¸ì„ ëˆ„ë¥¼ ê²½ìš°ì—ë§Œ trueë¥¼ ë°˜í™˜í•˜ëŠ” í•¨ìˆ˜
        function confirmAction(message) {
            return confirm(message);
        }

        // í¼ ì œì¶œì„ ì²˜ë¦¬í•˜ëŠ” í•¨ìˆ˜
        function handleFormSubmit(formId, paramKey) {
            document.getElementById(formId).addEventListener('submit', function (event) {
                event.preventDefault();
                const params = getURLParams();
                const input = document.getElementById(paramKey);

                if (formId === 'gfid') { // formIdê°€ 'gfid'ì¼ ë•Œë§Œ ê²½ê³  ë©”ì‹œì§€ ì¶œë ¥
                    const confirmationMessage = "ê²€ìƒ‰ ì‹œ ì„ íƒëœ í•­ëª©ì´ ì „ì²´ ì´ˆê¸°í™”ë©ë‹ˆë‹¤. ê³„ì†í•˜ì‹œê² ìŠµë‹ˆê¹Œ?";
                    if (confirmAction(confirmationMessage)) {
                        if (input.value.trim() !== '') {
                            params[paramKey] = input.value.trim();
                            deleteOtherParams(params, paramKey);
                            updateURLParams(params);
                            // ì¶”ê°€ ì‘ì—…ì„ ìœ„í•œ ì½”ë“œë¥¼ ì—¬ê¸°ì— ì¶”ê°€í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì˜ˆë¥¼ ë“¤ì–´, í¼ ì œì¶œ ì²˜ë¦¬ ë“±
                        } else {
                            delete params[paramKey];
                            updateURLParams(params);
                        }
                    }
                } else {
                    if (input.value.trim() !== '') {
                        params[paramKey] = input.value.trim();
                        deleteOtherParams(params, paramKey);
                        updateURLParams(params);
                        // ì¶”ê°€ ì‘ì—…ì„ ìœ„í•œ ì½”ë“œë¥¼ ì—¬ê¸°ì— ì¶”ê°€í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì˜ˆë¥¼ ë“¤ì–´, í¼ ì œì¶œ ì²˜ë¦¬ ë“±
                    } else {
                        delete params[paramKey];
                        updateURLParams(params);
                    }
                }
            });
        }

        // ë‹¤ë¥¸ íŒŒë¼ë¯¸í„°ë¥¼ ëª¨ë‘ ì‚­ì œí•˜ëŠ” í•¨ìˆ˜
        function deleteOtherParams(params, paramKey) {
            for (const key in params) {
                if (key !== paramKey) {
                    delete params[key];
                }
            }
        }

        // í˜ì´ì§€ ë¡œë“œì‹œ ì…ë ¥ë€ì— URL íŒŒë¼ë¯¸í„° ê°’ì„ ì±„ìš°ëŠ” í•¨ìˆ˜
        function populateInputWithParams(formId, paramKey) {
            const params = getURLParams();
            const input = document.getElementById(paramKey);

            if (params[paramKey]) {
                input.value = params[paramKey];
            }
        }

        // í¼ ì œì¶œ ì²˜ë¦¬
        handleFormSubmit('searchForm', 'gfid');
        populateInputWithParams('searchForm', 'gfid');

        handleFormSubmit('minmaxPriceForm', 'minPrice');
        handleFormSubmit('minmaxPriceForm', 'maxPrice');
        populateInputWithParams('minmaxPriceForm', 'minPrice');
        populateInputWithParams('minmaxPriceForm', 'maxPrice');

        // í˜ì´ì§€ ë¡œë“œì‹œ ì…ë ¥ë€ì— URL íŒŒë¼ë¯¸í„° ê°’ì„ ì±„ìš°ëŠ” í•¨ìˆ˜
        window.addEventListener('load', function () {
            const params = getURLParams();
            const input = document.getElementById('gfid');

            if (params['gfid']) {
                input.value = params['gfid'];
            }
        });


        function transformCoord(coordinates, properties, type) {
            // MultiPolygon ì§€ì›ì„ ìœ„í•œ ë³€í™˜ ê³¼ì •
            let paths = [];

            if (type === 'polygon') {
                coordinates.forEach(polygon => {
                    let path = polygon.map(coord =>
                        new kakao.maps.LatLng(coord[1], coord[0]));
                    paths.push(path); // MultiPolygonì˜ ê²½ìš° ì—¬ëŸ¬ pathë¥¼ ë°°ì—´ë¡œ ê´€ë¦¬
                });
            } else if (type === 'circle') {
                coordinates.forEach(circle => {
                    paths.push(circle); // MultiPolygonì˜ ê²½ìš° ì—¬ëŸ¬ pathë¥¼ ë°°ì—´ë¡œ ê´€ë¦¬
                });

            }
            let result = {
                "name": properties.name,
                "gid": properties.gid,
                "fid": properties.fid,
                "y_pred_lgb": properties.y_pred_lgb,
                "color": properties.color,
                "public_price": properties.public_price,
                "population": properties.population,
                "altitude": properties.altitude,
                "emd_nm_k": properties.emd_nm_k,
                "path": paths
            };
            // ë§Œì•½ properties.addressê°€ ì¡´ì¬í•œë‹¤ë©´
            if (properties.address) {
                result.address = properties.address; // address ì†ì„±ì„ ì¶”ê°€í•©ë‹ˆë‹¤.
            }

            return result;
        }

        // ResultGEO ë°ì´í„° ì²˜ë¦¬
        const ResultGEO = {{ data.value.ResultGEO|safe }}

        let ResultGEO_AREA = [];
        // ì¢Œí‘œ ì¶”ì¶œ ë° ê¸°íƒ€ ì •ë³´ ë¦¬ìŠ¤íŠ¸í™”
        if (ResultGEO.features && ResultGEO.features.length > 0) {
            ResultGEO.features.forEach(feature => {
                let properties = feature.properties
                if (feature.geometry && feature.geometry.coordinates) {
                    // geometryì˜ íƒ€ì…ì— ë”°ë¼ ë‹¤ë£¨ëŠ” ë°©ì‹ì´ ë‹¬ë¼ì§ˆ ìˆ˜ ìˆìŠµë‹ˆë‹¤.
                    const coordinates = feature.geometry.coordinates;
                    ResultGEO_AREA.push(transformCoord(coordinates, properties, 'polygon'));
                }
            });
        }


        // RecommandGEO ë°ì´í„° ì²˜ë¦¬
        const RecommandGEO = {{ data.value.RecommandGEO|safe }}

        let RecommandGEO_AREA = [];
        // ì¢Œí‘œ ì¶”ì¶œ ë° ê¸°íƒ€ ì •ë³´ ë¦¬ìŠ¤íŠ¸í™”
        if (RecommandGEO.features && RecommandGEO.features.length > 0) {
            RecommandGEO.features.forEach(feature => {
                let properties = feature.properties
                if (feature.geometry && feature.geometry.coordinates) {
                    // geometryì˜ íƒ€ì…ì— ë”°ë¼ ë‹¤ë£¨ëŠ” ë°©ì‹ì´ ë‹¬ë¼ì§ˆ ìˆ˜ ìˆìŠµë‹ˆë‹¤.
                    const coordinates = feature.geometry.coordinates;
                    RecommandGEO_AREA.push(transformCoord(coordinates, properties, 'circle'));
                }
            });
        }


        // RecommandGSGEO ë°ì´í„° ì²˜ë¦¬
        const RecommandGSGEO = {{ data.value.RecommandGSGEO|safe }}

        let RecommandGSGEO_AREA = [];
        // ì¢Œí‘œ ì¶”ì¶œ ë° ê¸°íƒ€ ì •ë³´ ë¦¬ìŠ¤íŠ¸í™”
        if (RecommandGSGEO.features && RecommandGSGEO.features.length > 0) {
            RecommandGSGEO.features.forEach(feature => {
                let properties = feature.properties
                if (feature.geometry && feature.geometry.coordinates) {
                    // geometryì˜ íƒ€ì…ì— ë”°ë¼ ë‹¤ë£¨ëŠ” ë°©ì‹ì´ ë‹¬ë¼ì§ˆ ìˆ˜ ìˆìŠµë‹ˆë‹¤.
                    const coordinates = feature.geometry.coordinates;
                    RecommandGSGEO_AREA.push(transformCoord(coordinates, properties, 'circle'));
                }
            });
        }

        // existInstalledGEO ë°ì´í„° ì²˜ë¦¬
        const existInstalledGEO = {{ data.value.existInstalledGEO|safe }}

        let existInstalledGEO_AREA = [];
        // ì¢Œí‘œ ì¶”ì¶œ ë° ê¸°íƒ€ ì •ë³´ ë¦¬ìŠ¤íŠ¸í™”
        if (existInstalledGEO.features && existInstalledGEO.features.length > 0) {
            existInstalledGEO.features.forEach(feature => {
                let properties = feature.properties
                if (feature.geometry && feature.geometry.coordinates) {
                    // geometryì˜ íƒ€ì…ì— ë”°ë¼ ë‹¤ë£¨ëŠ” ë°©ì‹ì´ ë‹¬ë¼ì§ˆ ìˆ˜ ìˆìŠµë‹ˆë‹¤.
                    const coordinates = feature.geometry.coordinates;
                    existInstalledGEO_AREA.push(transformCoord(coordinates, properties, 'circle'));
                }
            });
        }

        // existInstalledGridGEO ë°ì´í„° ì²˜ë¦¬
        const existInstalledGridGEO = {{ data.value.existInstalledGridGEO|safe }}
        let existInstalledGridGEO_AREA = [];
        // ì¢Œí‘œ ì¶”ì¶œ ë° ê¸°íƒ€ ì •ë³´ ë¦¬ìŠ¤íŠ¸í™”
        if (existInstalledGridGEO.features && existInstalledGridGEO.features.length > 0) {
            existInstalledGridGEO.features.forEach(feature => {
                let properties = feature.properties
                if (feature.geometry && feature.geometry.coordinates) {
                    // geometryì˜ íƒ€ì…ì— ë”°ë¼ ë‹¤ë£¨ëŠ” ë°©ì‹ì´ ë‹¬ë¼ì§ˆ ìˆ˜ ìˆìŠµë‹ˆë‹¤.
                    const coordinates = feature.geometry.coordinates;
                    existInstalledGridGEO_AREA.push(transformCoord(coordinates, properties, 'polygon'));
                }
            });
        }


        // ResultGEO: ì˜ì—­ë°ì´í„° í‘œì‹œ
        for (let i = 0, len = ResultGEO_AREA.length; i < len; i++) {
            displayArea(ResultGEO_AREA[i], 'polygon');
        }


        // existInstalledGridGEO: ì˜ì—­ë°ì´í„° í‘œì‹œ
        for (let i = 0, len = existInstalledGridGEO_AREA.length; i < len; i++) {
            displayArea(existInstalledGridGEO_AREA[i], 'polygon');
        }

        // RecommandGEO: ì˜ì—­ë°ì´í„° í‘œì‹œ
        for (let i = 0, len = RecommandGEO_AREA.length; i < len; i++) {
            displayArea(RecommandGEO_AREA[i], 'circle');
        }

        // RecommandGSGEO: ì˜ì—­ë°ì´í„° í‘œì‹œ
        for (let i = 0, len = RecommandGSGEO_AREA.length; i < len; i++) {
            displayArea(RecommandGSGEO_AREA[i], 'circle');
        }

        // existInstalledGEO: ì˜ì—­ë°ì´í„° í‘œì‹œ
        for (let i = 0, len = existInstalledGEO_AREA.length; i < len; i++) {
            displayArea(existInstalledGEO_AREA[i], 'circle');
        }


        // ë‹¤ê°í˜•ì„ ìƒì„±í•˜ê³  ì´ë²¤íŠ¸ë¥¼ ë“±ë¡í•˜ëŠ” í•¨ìˆ˜ì…ë‹ˆë‹¤
        function displayArea(area, figureType) {
            // ì› ìƒì„± ìƒì„±í•©ë‹ˆë‹¤
            if (figureType === 'circle') {
                let circle = new kakao.maps.Circle({
                        center: new kakao.maps.LatLng(area.path[0][1], area.path[0][0]),  // ì›ì˜ ì¤‘ì‹¬ì¢Œí‘œ ì…ë‹ˆë‹¤
                        radius: 100, // ë¯¸í„° ë‹¨ìœ„ì˜ ì›ì˜ ë°˜ì§€ë¦„ì…ë‹ˆë‹¤
                        strokeWeight: 3, // ì„ ì˜ ë‘ê»˜ì…ë‹ˆë‹¤
                        strokeColor: area.color, // ì„ ì˜ ìƒ‰ê¹”ì…ë‹ˆë‹¤
                        strokeOpacity: 1, // ì„ ì˜ ë¶ˆíˆ¬ëª…ë„ ì…ë‹ˆë‹¤ 1ì—ì„œ 0 ì‚¬ì´ì˜ ê°’ì´ë©° 0ì— ê°€ê¹Œìš¸ìˆ˜ë¡ íˆ¬ëª…í•©ë‹ˆë‹¤
                        strokeStyle: 'solid', // ì„ ì˜ ìŠ¤íƒ€ì¼ ì…ë‹ˆë‹¤
                        fillColor: '#d3d3d3', // ì±„ìš°ê¸° ìƒ‰ê¹”ì…ë‹ˆë‹¤
                        fillOpacity: 0.7  // ì±„ìš°ê¸° ë¶ˆíˆ¬ëª…ë„ ì…ë‹ˆë‹¤
                    })
                ;

                circle.setMap(map);

                // ë‹¤ê°í˜•ì— mouseover ì´ë²¤íŠ¸ë¥¼ ë“±ë¡í•˜ê³  ì´ë²¤íŠ¸ê°€ ë°œìƒí•˜ë©´ í´ë¦¬ê³¤ì˜ ì±„ì›€ìƒ‰ì„ ë³€ê²½í•©ë‹ˆë‹¤
                // ì§€ì—­ëª…ì„ í‘œì‹œí•˜ëŠ” ì»¤ìŠ¤í…€ì˜¤ë²„ë ˆì´ë¥¼ ì§€ë„ìœ„ì— í‘œì‹œí•©ë‹ˆë‹¤
                kakao.maps.event.addListener(circle, 'mouseover', function (mouseEvent) {
                    circle.setOptions({fillColor: '#181818'});

                    customOverlay.setContent('<div class="area">' + area.name + '</div>');

                    customOverlay.setPosition(mouseEvent.latLng);
                    customOverlay.setMap(map);
                });

                // ë‹¤ê°í˜•ì— mousemove ì´ë²¤íŠ¸ë¥¼ ë“±ë¡í•˜ê³  ì´ë²¤íŠ¸ê°€ ë°œìƒí•˜ë©´ ì»¤ìŠ¤í…€ ì˜¤ë²„ë ˆì´ì˜ ìœ„ì¹˜ë¥¼ ë³€ê²½í•©ë‹ˆë‹¤
                kakao.maps.event.addListener(circle, 'mousemove', function (mouseEvent) {
                    customOverlay.setPosition(mouseEvent.latLng);
                });

                // ë‹¤ê°í˜•ì— mouseout ì´ë²¤íŠ¸ë¥¼ ë“±ë¡í•˜ê³  ì´ë²¤íŠ¸ê°€ ë°œìƒí•˜ë©´ í´ë¦¬ê³¤ì˜ ì±„ì›€ìƒ‰ì„ ì›ë˜ìƒ‰ìœ¼ë¡œ ë³€ê²½í•©ë‹ˆë‹¤
                // ì»¤ìŠ¤í…€ ì˜¤ë²„ë ˆì´ë¥¼ ì§€ë„ì—ì„œ ì œê±°í•©ë‹ˆë‹¤
                kakao.maps.event.addListener(circle, 'mouseout', function () {
                    circle.setOptions({fillColor: '#d3d3d3'});
                    customOverlay.setMap(null);
                });

                // ë‹¤ê°í˜•ì— click ì´ë²¤íŠ¸ë¥¼ ë“±ë¡í•˜ê³  ì´ë²¤íŠ¸ê°€ ë°œìƒí•˜ë©´ ë‹¤ê°í˜•ì˜ ì´ë¦„ê³¼ ë©´ì ì„ ì¸í¬ìœˆë„ìš°ì— í‘œì‹œí•©ë‹ˆë‹¤
                kakao.maps.event.addListener(circle, 'click', function () {
                    let content =
                        '<div class="card-title" style="display: flex;flex-direction: row;justify-content: space-between">' +
                        '   <a style="margin:0;color: #181818;">' + area.name + '</a>' +
                        '   <div onclick="closeDetail();" style="width: 15px;height:15px;cursor:pointer;"><i class="fa-solid fa-close"></i></div>' +
                        '</div>' +

                        (area.address ?
                            '<div class="card-contents-detail" style="display: flex;flex-direction: column;padding: 0 0 20px 0">' +
                            '   <a style="font-weight: 700"><i style="width:15px" class="fa-solid fa-location-dot"></i>ì£¼ì†Œ</a><a style=padding-left:3px>' + area.address + '</a>' +
                            '</div>'
                            : '') +

                        (area.gid ?
                            '<div class="card-contents-detail">' +
                            '   <a style="font-weight: 700"><i style="width:15px" class="fa-solid fa-fingerprint"></i>ê³ ìœ ì½”ë“œ:</a><a style=padding-left:3px>' + area.gid +
                            (area.fid ?
                                '(' + area.fid + ')'
                                : '') +

                            '</a>' +
                            '</div>'
                            : '') +

                        '<div class="card-contents-detail">' +
                        '   <a style="font-weight: 700"><i style="width:15px" class="fa-solid fa-location-dot"></i>ë²•ì •ë™:</a><a style=padding-left:3px>' + area.emd_nm_k + '</a>' +
                        '</div>' +

                        '<div class="card-contents-detail">' +
                        '   <a style="font-weight: 700"><i style="width:15px" class="fa-solid fa-sack-dollar"></i>ê³µì‹œì§€ê°€:</a><a style=padding-left:3px>' + Math.floor(area.public_price).toLocaleString('ko-KR') + ' ì›/ã¡</a>' +
                        '</div>' +

                        '<div class="card-contents-detail">' +
                        '   <a style="font-weight: 700"><i style="width:15px" class="fa-solid fa-people-roof"></i>ì¸êµ¬:</a><a style=padding-left:3px>' + area.population + ' ëª…</a>' +
                        '</div>' +

                        '<div class="card-contents-detail" style="padding: 0 0 20px 0;">' +
                        '   <a style="font-weight: 700"><i style="width:15px" class="fa-solid fa-up-down"></i>ê³ ë„:</a><a style=padding-left:3px>' + area.altitude + ' m</div>';
                    +
                        '</div>';
                    const element = document.getElementById('card');
                    element.style.display = 'block'
                    element.innerHTML = content
                })

            } else if (figureType === 'polygon') {
                let polygon = new kakao.maps.Polygon({
                    map: map,
                    path: area.path,
                    strokeWeight: 3,
                    strokeColor: area.color,
                    strokeOpacity: 1,
                    fillColor: '#FFFFFF',
                    fillOpacity: 0.5
                });

                // ë‹¤ê°í˜•ì— mouseover ì´ë²¤íŠ¸ë¥¼ ë“±ë¡í•˜ê³  ì´ë²¤íŠ¸ê°€ ë°œìƒí•˜ë©´ í´ë¦¬ê³¤ì˜ ì±„ì›€ìƒ‰ì„ ë³€ê²½í•©ë‹ˆë‹¤
                // ì§€ì—­ëª…ì„ í‘œì‹œí•˜ëŠ” ì»¤ìŠ¤í…€ì˜¤ë²„ë ˆì´ë¥¼ ì§€ë„ìœ„ì— í‘œì‹œí•©ë‹ˆë‹¤
                kakao.maps.event.addListener(polygon, 'mouseover', function (mouseEvent) {
                    polygon.setOptions({fillColor: '#181818'});

                    customOverlay.setContent('<div class="area">' + area.name + '</div>');

                    customOverlay.setPosition(mouseEvent.latLng);
                    customOverlay.setMap(map);
                });

                // ë‹¤ê°í˜•ì— mousemove ì´ë²¤íŠ¸ë¥¼ ë“±ë¡í•˜ê³  ì´ë²¤íŠ¸ê°€ ë°œìƒí•˜ë©´ ì»¤ìŠ¤í…€ ì˜¤ë²„ë ˆì´ì˜ ìœ„ì¹˜ë¥¼ ë³€ê²½í•©ë‹ˆë‹¤
                kakao.maps.event.addListener(polygon, 'mousemove', function (mouseEvent) {

                    customOverlay.setPosition(mouseEvent.latLng);
                });

                // ë‹¤ê°í˜•ì— mouseout ì´ë²¤íŠ¸ë¥¼ ë“±ë¡í•˜ê³  ì´ë²¤íŠ¸ê°€ ë°œìƒí•˜ë©´ í´ë¦¬ê³¤ì˜ ì±„ì›€ìƒ‰ì„ ì›ë˜ìƒ‰ìœ¼ë¡œ ë³€ê²½í•©ë‹ˆë‹¤
                // ì»¤ìŠ¤í…€ ì˜¤ë²„ë ˆì´ë¥¼ ì§€ë„ì—ì„œ ì œê±°í•©ë‹ˆë‹¤
                kakao.maps.event.addListener(polygon, 'mouseout', function () {
                    polygon.setOptions({fillColor: '#FFFFFF'});
                    customOverlay.setMap(null);
                });

                // ë‹¤ê°í˜•ì— click ì´ë²¤íŠ¸ë¥¼ ë“±ë¡í•˜ê³  ì´ë²¤íŠ¸ê°€ ë°œìƒí•˜ë©´ ë‹¤ê°í˜•ì˜ ì´ë¦„ê³¼ ë©´ì ì„ ì¸í¬ìœˆë„ìš°ì— í‘œì‹œí•©ë‹ˆë‹¤
                kakao.maps.event.addListener(polygon, 'click', function () {
                    let predictionText = '';
                    if (area.y_pred_lgb === 1) {
                        predictionText = 'ê¸‰ì†';
                        predictionColor = '#EC6060'
                    } else if (area.y_pred_lgb === 2) {
                        predictionText = 'ì™„ì†';
                        predictionColor = '#4277F1'
                    } else if (area.y_pred_lgb === 3) {
                        predictionText = 'ê¸‰/ì™„ì†';
                        predictionColor = '#BE83B9'
                    }
                    let content =
                        '<div class="card-title" style="display: flex;flex-direction: row;justify-content: space-between">' +
                        '   <div style="display: flex"><a style="margin:0;color: #181818;">' + area.name + '</a>' +
                        '   <div style="margin: 0 0 0 10px;height:20px;background: ' + predictionColor + ';border-radius: 15px;padding: 2px 10px 2px 5px;color:#FFFFFF;"><i class="fa-solid fa-bolt"></i><a style="font-size:14px;">' + predictionText + '</a></div></div>' +
                        '   <div onclick="closeDetail();" style="width: 15px;height:15px;cursor:pointer;"><i class="fa-solid fa-close"></i></div>' +
                        '</div>' +
                        (area.gid ?
                            '<div class="card-contents-detail">' +
                            '   <a style="font-weight: 700"><i style="width:15px" class="fa-solid fa-fingerprint"></i>ê³ ìœ ì½”ë“œ:</a><a style=padding-left:3px>' + area.gid +
                            (area.fid ?
                                '(' + area.fid + ')'
                                : '') +

                            '</a>' +
                            '</div>'
                            : '') +
                        '<div class="card-contents-detail">' +
                        '   <a style="font-weight: 700"><i style="width:15px" class="fa-solid fa-location-dot"></i>ë²•ì •ë™:</a><a style=padding-left:3px>' + area.emd_nm_k + '</a>' +
                        '</div>' +

                        '<div class="card-contents-detail">' +
                        '   <a style="font-weight: 700"><i style="width:15px" class="fa-solid fa-sack-dollar"></i>ê³µì‹œì§€ê°€:</a><a style=padding-left:3px>' + Math.floor(area.public_price).toLocaleString('ko-KR') + ' ì›/ã¡</a>' +
                        '</div>' +

                        '<div class="card-contents-detail">' +
                        '   <a style="font-weight: 700"><i style="width:15px" class="fa-solid fa-people-roof"></i>ì¸êµ¬:</a><a style=padding-left:3px>' + area.population + ' ëª…</a>' +
                        '</div>' +

                        '<div class="card-contents-detail" style="padding: 0 0 20px 0;">' +
                        '   <a style="font-weight: 700"><i style="width:15px" class="fa-solid fa-up-down"></i>ê³ ë„:</a><a style=padding-left:3px>' + area.altitude + ' m</div>';
                    '</div>';
                    const element = document.getElementById('card');
                    element.style.display = 'block'
                    element.innerHTML = content
                })
            }

        }

    </script>

{% endblock %}

